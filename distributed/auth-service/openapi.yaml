openapi: 3.0.3
info:
  title: Auth Service API
  description: |
    Authentication and Authorization Service for the Sports Tournament Architecture.

    This service handles:
    - User authentication (registration, login, logout, token management)
    - Role-Based Access Control (RBAC)
    - Permission management
    - User management (CRUD operations)
    - Internal service endpoints for user validation

    **Authentication**: All protected endpoints require a Bearer token obtained from the login or register endpoints.
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8001/api/
    description: Local development server
  - url: https://api.example.com/api
    description: Production server

tags:
  - name: Authentication
    description: User authentication endpoints (public)
  - name: User Management
    description: User CRUD operations (protected)
  - name: Role Management
    description: Role CRUD operations (protected)
  - name: Permission Management
    description: Permission CRUD operations (protected)
  - name: Internal Service
    description: Internal endpoints for service-to-service communication (protected)
  - name: Health
    description: Health check and service information endpoints

paths:
  /auth/register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Register a new user account and receive an access token
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            examples:
              example1:
                summary: Standard registration
                value:
                  name: "John Doe"
                  email: "john.doe@example.com"
                  password: "password123"
                  password_confirmation: "password123"
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              example:
                success: true
                message: "User registered successfully"
                data:
                  user:
                    id: 1
                    name: "John Doe"
                    email: "john.doe@example.com"
                    email_verified_at: null
                    created_at: "2024-01-01T00:00:00.000000Z"
                    updated_at: "2024-01-01T00:00:00.000000Z"
                  token: "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9..."
                  token_type: "Bearer"
                timestamp: "2024-01-01T00:00:00.000000Z"
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user credentials and receive an access token
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              example1:
                summary: Standard login
                value:
                  email: "john.doe@example.com"
                  password: "password123"
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              example:
                success: true
                message: "Login successful"
                data:
                  user:
                    id: 1
                    name: "John Doe"
                    email: "john.doe@example.com"
                    email_verified_at: "2024-01-01T00:00:00.000000Z"
                    created_at: "2024-01-01T00:00:00.000000Z"
                    updated_at: "2024-01-01T00:00:00.000000Z"
                  token: "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9..."
                  token_type: "Bearer"
                timestamp: "2024-01-01T00:00:00.000000Z"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout user
      description: Invalidate the current access token
      operationId: logout
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: "Successfully logged out"
                data: null
                timestamp: "2024-01-01T00:00:00.000000Z"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: Revoke current token and issue a new access token
      operationId: refresh
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              example:
                success: true
                message: "Token refreshed successfully"
                data:
                  user:
                    id: 1
                    name: "John Doe"
                    email: "john.doe@example.com"
                    email_verified_at: "2024-01-01T00:00:00.000000Z"
                    created_at: "2024-01-01T00:00:00.000000Z"
                    updated_at: "2024-01-01T00:00:00.000000Z"
                  token: "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9..."
                  token_type: "Bearer"
                timestamp: "2024-01-01T00:00:00.000000Z"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/me:
    get:
      tags:
        - Authentication
      summary: Get authenticated user profile
      description: Get the current authenticated user with roles and permissions
      operationId: getMe
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileResponse'
              example:
                success: true
                message: "User profile retrieved successfully"
                data:
                  user:
                    id: 1
                    name: "John Doe"
                    email: "john.doe@example.com"
                    email_verified_at: "2024-01-01T00:00:00.000000Z"
                    created_at: "2024-01-01T00:00:00.000000Z"
                    updated_at: "2024-01-01T00:00:00.000000Z"
                  roles:
                    - id: 1
                      name: "admin"
                      description: "Administrator role"
                    - id: 2
                      name: "user"
                      description: "Regular user role"
                  permissions:
                    - id: 1
                      name: "users.create"
                      description: "Permission to create users"
                    - id: 2
                      name: "users.update"
                      description: "Permission to update users"
                timestamp: "2024-01-01T00:00:00.000000Z"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/ServerError'

  /admin/users:
    get:
      tags:
        - User Management
      summary: List all users
      description: Get a paginated list of all users with optional search
      operationId: listUsers
      security:
        - bearerAuth: []
      parameters:
        - name: per_page
          in: query
          description: Number of items per page (1-100)
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 15
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: search
          in: query
          description: Search by name or email
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedUserResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/ServerError'

    post:
      tags:
        - User Management
      summary: Create a new user
      description: Create a new user account with optional role assignment
      operationId: createUser
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
            examples:
              example1:
                summary: Create user with roles
                value:
                  name: "Jane Doe"
                  email: "jane.doe@example.com"
                  password: "password123"
                  role_ids: [1, 2]
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'

  /admin/users/{id}:
    get:
      tags:
        - User Management
      summary: Get user by ID
      description: Get detailed information about a specific user including roles and permissions
      operationId: getUserById
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: integer
      responses:
        '200':
          description: User retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDetailResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

    put:
      tags:
        - User Management
      summary: Update user
      description: Update user information (full update)
      operationId: updateUser
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'

    patch:
      tags:
        - User Management
      summary: Update user (partial)
      description: Partially update user information
      operationId: updateUserPartial
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'

    delete:
      tags:
        - User Management
      summary: Delete user
      description: Delete a user account. Cannot delete your own account.
      operationId: deleteUser
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: integer
      responses:
        '200':
          description: User deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Cannot delete your own account
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /admin/roles:
    get:
      tags:
        - Role Management
      summary: List all roles
      description: Get a paginated list of all roles with optional search
      operationId: listRoles
      security:
        - bearerAuth: []
      parameters:
        - name: per_page
          in: query
          description: Number of items per page (1-100)
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 15
        - name: search
          in: query
          description: Search by name or description
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Roles retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedRoleResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/ServerError'

    post:
      tags:
        - Role Management
      summary: Create a new role
      description: Create a new role with optional permission assignment
      operationId: createRole
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRoleRequest'
            examples:
              example1:
                summary: Create role with permissions
                value:
                  name: "moderator"
                  description: "Moderator role with limited permissions"
                  permission_ids: [1, 2, 3]
      responses:
        '201':
          description: Role created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'

  /admin/roles/{id}:
    get:
      tags:
        - Role Management
      summary: Get role by ID
      description: Get detailed information about a specific role including permissions and users
      operationId: getRoleById
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Role ID
          schema:
            type: integer
      responses:
        '200':
          description: Role retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleDetailResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

    put:
      tags:
        - Role Management
      summary: Update role
      description: Update role information (full update)
      operationId: updateRole
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Role ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRoleRequest'
      responses:
        '200':
          description: Role updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'

    patch:
      tags:
        - Role Management
      summary: Update role (partial)
      description: Partially update role information
      operationId: updateRolePartial
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Role ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRoleRequest'
      responses:
        '200':
          description: Role updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'

    delete:
      tags:
        - Role Management
      summary: Delete role
      description: Delete a role. Cannot delete roles that have users assigned.
      operationId: deleteRole
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Role ID
          schema:
            type: integer
      responses:
        '200':
          description: Role deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Cannot delete role with assigned users
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /admin/permissions:
    get:
      tags:
        - Permission Management
      summary: List all permissions
      description: Get a paginated list of all permissions with optional search
      operationId: listPermissions
      security:
        - bearerAuth: []
      parameters:
        - name: per_page
          in: query
          description: Number of items per page (1-100)
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 15
        - name: search
          in: query
          description: Search by name or description
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Permissions retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedPermissionResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/ServerError'

    post:
      tags:
        - Permission Management
      summary: Create a new permission
      description: Create a new permission
      operationId: createPermission
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePermissionRequest'
            examples:
              example1:
                summary: Create permission
                value:
                  name: "users.delete"
                  description: "Permission to delete users"
      responses:
        '201':
          description: Permission created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PermissionResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'

  /admin/permissions/{id}:
    get:
      tags:
        - Permission Management
      summary: Get permission by ID
      description: Get detailed information about a specific permission including roles
      operationId: getPermissionById
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Permission ID
          schema:
            type: integer
      responses:
        '200':
          description: Permission retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PermissionDetailResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

    put:
      tags:
        - Permission Management
      summary: Update permission
      description: Update permission information (full update)
      operationId: updatePermission
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Permission ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePermissionRequest'
      responses:
        '200':
          description: Permission updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PermissionDetailResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'

    patch:
      tags:
        - Permission Management
      summary: Update permission (partial)
      description: Partially update permission information
      operationId: updatePermissionPartial
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Permission ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePermissionRequest'
      responses:
        '200':
          description: Permission updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PermissionDetailResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'

    delete:
      tags:
        - Permission Management
      summary: Delete permission
      description: Delete a permission. Cannot delete permissions that are assigned to roles.
      operationId: deletePermission
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Permission ID
          schema:
            type: integer
      responses:
        '200':
          description: Permission deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Cannot delete permission assigned to roles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /users/{id}:
    get:
      tags:
        - Internal Service
      summary: Get user by ID (internal)
      description: Internal endpoint for other services to get user details with roles and permissions
      operationId: getUserByIdInternal
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: integer
      responses:
        '200':
          description: User retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDetailResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /users/{id}/validate:
    get:
      tags:
        - Internal Service
      summary: Validate user existence by ID
      description: Internal endpoint to validate if a user exists by ID
      operationId: validateUserById
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: integer
      responses:
        '200':
          description: User exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserValidationResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /users/{id}/roles:
    post:
      tags:
        - Internal Service
      summary: Assign role to user
      description: Internal endpoint to assign a role to a user
      operationId: assignRoleToUser
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role_id
              properties:
                role_id:
                  type: integer
                  description: Role ID to assign
            examples:
              example1:
                summary: Assign role
                value:
                  role_id: 1
      responses:
        '200':
          description: Role assigned successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleAssignmentResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: User already has this role
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /users/{id}/permissions:
    get:
      tags:
        - Internal Service
      summary: Get user permissions
      description: Internal endpoint to get all permissions for a user (from all roles)
      operationId: getUserPermissions
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: integer
      responses:
        '200':
          description: User permissions retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserPermissionsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /users/validate:
    post:
      tags:
        - Internal Service
      summary: Validate user by email
      description: Internal endpoint to validate if a user exists by email
      operationId: validateUserByEmail
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: User email address
            examples:
              example1:
                summary: Validate by email
                value:
                  email: "john.doe@example.com"
      responses:
        '200':
          description: User validation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserValidationResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Basic health check endpoint
      operationId: healthCheck
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  service:
                    type: string
                  version:
                    type: string
                  timestamp:
                    type: string
                    format: date-time
              example:
                success: true
                message: "Authentication Service is running"
                service: "auth-service"
                version: "1.0.0"
                timestamp: "2024-01-01T00:00:00.000000Z"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        OAuth2 Bearer token authentication using Laravel Passport.
        Include the token in the Authorization header: `Authorization: Bearer {token}`

  schemas:
    RegisterRequest:
      type: object
      required:
        - name
        - email
        - password
        - password_confirmation
      properties:
        name:
          type: string
          maxLength: 255
          description: User's full name
          example: "John Doe"
        email:
          type: string
          format: email
          maxLength: 255
          description: User's email address (must be unique)
          example: "john.doe@example.com"
        password:
          type: string
          format: password
          minLength: 8
          description: User's password
          example: "password123"
        password_confirmation:
          type: string
          format: password
          minLength: 8
          description: Password confirmation (must match password)
          example: "password123"

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User's email address
          example: "john.doe@example.com"
        password:
          type: string
          format: password
          minLength: 6
          description: User's password
          example: "password123"

    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'
            token:
              type: string
              description: OAuth2 access token
            token_type:
              type: string
              example: "Bearer"
        timestamp:
          type: string
          format: date-time

    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        email:
          type: string
          format: email
        email_verified_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    UserProfileResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'
            roles:
              type: array
              items:
                $ref: '#/components/schemas/Role'
            permissions:
              type: array
              items:
                $ref: '#/components/schemas/Permission'
        timestamp:
          type: string
          format: date-time

    CreateUserRequest:
      type: object
      required:
        - name
        - email
        - password
      properties:
        name:
          type: string
          maxLength: 255
        email:
          type: string
          format: email
          maxLength: 255
        password:
          type: string
          format: password
          minLength: 8
        role_ids:
          type: array
          items:
            type: integer
          description: Array of role IDs to assign to the user

    UpdateUserRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        email:
          type: string
          format: email
          maxLength: 255
        password:
          type: string
          format: password
          minLength: 8
        role_ids:
          type: array
          items:
            type: integer
          description: Array of role IDs to sync with the user

    UserResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          $ref: '#/components/schemas/UserWithRoles'
        timestamp:
          type: string
          format: date-time

    UserWithRoles:
      allOf:
        - $ref: '#/components/schemas/User'
        - type: object
          properties:
            roles:
              type: array
              items:
                $ref: '#/components/schemas/Role'

    UserDetailResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          allOf:
            - $ref: '#/components/schemas/User'
            - type: object
              properties:
                roles:
                  type: array
                  items:
                    $ref: '#/components/schemas/RoleWithPermissions'
        timestamp:
          type: string
          format: date-time

    Role:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
          nullable: true

    RoleWithPermissions:
      allOf:
        - $ref: '#/components/schemas/Role'
        - type: object
          properties:
            permissions:
              type: array
              items:
                $ref: '#/components/schemas/Permission'

    CreateRoleRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          maxLength: 255
        description:
          type: string
          maxLength: 500
          nullable: true
        permission_ids:
          type: array
          items:
            type: integer
          description: Array of permission IDs to assign to the role

    UpdateRoleRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        description:
          type: string
          maxLength: 500
          nullable: true
        permission_ids:
          type: array
          items:
            type: integer
          description: Array of permission IDs to sync with the role

    RoleResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          $ref: '#/components/schemas/RoleWithPermissions'
        timestamp:
          type: string
          format: date-time

    RoleDetailResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          allOf:
            - $ref: '#/components/schemas/Role'
            - type: object
              properties:
                created_at:
                  type: string
                  format: date-time
                updated_at:
                  type: string
                  format: date-time
                permissions:
                  type: array
                  items:
                    $ref: '#/components/schemas/Permission'
                users:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: integer
                      name:
                        type: string
                      email:
                        type: string
        timestamp:
          type: string
          format: date-time

    Permission:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
          nullable: true

    CreatePermissionRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          maxLength: 255
        description:
          type: string
          maxLength: 500
          nullable: true

    UpdatePermissionRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        description:
          type: string
          maxLength: 500
          nullable: true

    PermissionResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          allOf:
            - $ref: '#/components/schemas/Permission'
            - type: object
              properties:
                created_at:
                  type: string
                  format: date-time
                updated_at:
                  type: string
                  format: date-time
        timestamp:
          type: string
          format: date-time

    PermissionDetailResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          allOf:
            - $ref: '#/components/schemas/Permission'
            - type: object
              properties:
                created_at:
                  type: string
                  format: date-time
                updated_at:
                  type: string
                  format: date-time
                roles:
                  type: array
                  items:
                    $ref: '#/components/schemas/Role'
        timestamp:
          type: string
          format: date-time

    PaginatedUserResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: array
          items:
            $ref: '#/components/schemas/UserWithRoles'
        pagination:
          $ref: '#/components/schemas/Pagination'
        timestamp:
          type: string
          format: date-time

    PaginatedRoleResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              name:
                type: string
              description:
                type: string
                nullable: true
              created_at:
                type: string
                format: date-time
              updated_at:
                type: string
                format: date-time
              permissions_count:
                type: integer
              users_count:
                type: integer
        pagination:
          $ref: '#/components/schemas/Pagination'
        timestamp:
          type: string
          format: date-time

    PaginatedPermissionResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              name:
                type: string
              description:
                type: string
                nullable: true
              created_at:
                type: string
                format: date-time
              updated_at:
                type: string
                format: date-time
              roles_count:
                type: integer
        pagination:
          $ref: '#/components/schemas/Pagination'
        timestamp:
          type: string
          format: date-time

    Pagination:
      type: object
      properties:
        current_page:
          type: integer
        last_page:
          type: integer
        per_page:
          type: integer
        total:
          type: integer
        from:
          type: integer
          nullable: true
        to:
          type: integer
          nullable: true
        has_more:
          type: boolean
        has_previous:
          type: boolean

    UserValidationResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            id:
              type: integer
            name:
              type: string
            email:
              type: string
            is_active:
              type: boolean
            exists:
              type: boolean
        timestamp:
          type: string
          format: date-time

    RoleAssignmentResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            user_id:
              type: integer
            role_id:
              type: integer
            role_name:
              type: string
        timestamp:
          type: string
          format: date-time

    UserPermissionsResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            user_id:
              type: integer
            permissions:
              type: array
              items:
                $ref: '#/components/schemas/Permission'
        timestamp:
          type: string
          format: date-time

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          nullable: true
        timestamp:
          type: string
          format: date-time

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
        errors:
          type: object
          nullable: true
          additionalProperties:
            type: array
            items:
              type: string
        error_code:
          type: string
          nullable: true
        timestamp:
          type: string
          format: date-time

  responses:
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: "Validation failed"
            errors:
              email:
                - "The email has already been taken."
              password:
                - "The password must be at least 8 characters."
            error_code: "VALIDATION_ERROR"
            timestamp: "2024-01-01T00:00:00.000000Z"

    Unauthorized:
      description: Unauthorized - Invalid or missing authentication token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: "Unauthorized"
            error_code: "UNAUTHORIZED"
            timestamp: "2024-01-01T00:00:00.000000Z"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: "User not found"
            error_code: "RESOURCE_NOT_FOUND"
            timestamp: "2024-01-01T00:00:00.000000Z"

    ServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: "Internal server error"
            error_code: "INTERNAL_SERVER_ERROR"
            timestamp: "2024-01-01T00:00:00.000000Z"
